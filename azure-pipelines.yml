name: $(BuildID)-$(Build.SourceBranchName)

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Build
  jobs:
  - job: Database
    steps:
    - script: ./build.sh --target pack-db --pack-version-postfix $(Build.BuildId)
    - publish: packs
      artifact: itlab-database-nuget

  - job: Backend
    steps:
    - script: ./build.sh --target publish --build-id $(Build.BuildId)
    - publish: deploy
      artifact: itlab-back
